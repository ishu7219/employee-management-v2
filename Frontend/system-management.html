<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Salary Management</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Bootstrap 5 CDN -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Font Awesome -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet">
  <!-- Custom CSS -->
  <link rel="stylesheet" href="salary.css">
</head>
<body>
  <div class="sidebar">
    <div class="sidebar-logo-row">
      <div class="sidebar-squares">
        <div class="sq1"></div>
        <div class="sq2"></div>
        <div class="sq3"></div>
        <div class="sq4"></div>
      </div>
      <span class="sidebar-title">ADMIN PANEL</span>
    </div>
    <nav class="flex-column">
      
      <a href="user-management.html" class="nav-link"><i class="fa fa-users"></i> User Management</a>
      <a href="system-management.html" class="nav-link active" id="sysMan"><i class="fa fa-sliders-h"></i> Salary management</a>
      <a href="leave-management.html" class="nav-link"><i class="fa fa-calendar-xmark"></i> Leave management</a>
      
      <a href="calendar.html" class="nav-link"><i class="fa fa-calendar-day"></i> Calendar</a>
      <a href="settings.html" class="nav-link"><i class="fa fa-gear"></i> Settings</a>
      
    </nav>
  </div>
  <div class="main-panel">
    <div class="header-row">
      <h3 style="font-weight:600;">Salary management</h3>
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
          <li class="breadcrumb-item">Home</li>
          <li class="breadcrumb-item active" aria-current="page">Manage salary</li>
        </ol>
      </nav>
    </div>
    <div class="admin-manager-card">
      <label style="font-weight:500;">Search</label>
      <div class="search-row mt-2">
        <label style="color:#555; margin-right:7px;">From</label>
        <input type="date" id="searchFromDate" />
        <label style="color:#555; margin-left:14px; margin-right:7px;">To</label>
        <input type="date" id="searchToDate" />
        <button class="btn btn-success ms-3" onclick="searchSalary()">Search</button>
        <button class="btn btn-danger ms-2" onclick="clearSalarySearch()">Clear</button>
      </div>
    </div>
    <div class="row g-4 px-3 py-1">
      <div class="col-lg-6">
        <div class="card p-3 mb-2">
          <button class="btn btn-danger mb-2" onclick="window.print()"><i class="fa fa-print"></i> Print</button>
          <div>
            <h6 style="font-weight:500; margin-bottom:13px;">Manage salary</h6>
            <div style="font-size:1rem;">
              <strong>Employee name:</strong> ganesh<br>
              <strong>Employee designation:</strong> Developer<br>
              <strong>Employee Salary:</strong> 15000<br>
              <strong>Employee leave:</strong> 0<br>
              <strong>Tax (1%):</strong> 150<br>
              <strong>Advance payment:</strong> 6501<br>
              <strong>Total:</strong> 8349
            </div>
          </div>
        </div>
      </div>
      <div class="col-lg-6">
        <div class="card p-3 mb-2">
          <h6 style="font-weight:500; margin-bottom:18px;">Advance payment</h6>
          <form id="advanceForm" class="row g-2 align-items-center mb-2">
            <div class="col-md-6">
              <label class="mb-1">Date</label>
              <input type="date" id="advDate" class="form-control" required />
            </div>
            <div class="col-md-6">
              <label class="mb-1">Amount</label>
              <input type="number" id="advAmount" class="form-control" min="1" required placeholder="Enter amount"/>
            </div>
            <div class="col-12 mt-2">
              <button class="btn btn-primary" type="submit">Add</button>
              <span id="advError" class="ms-3 text-danger" style="font-size:0.97rem;"></span>
            </div>
          </form>
        </div>
        <div class="card p-3">
          <h6 style="font-weight:500; margin-bottom:13px;">Advance payment lists</h6>
          <table class="table table-bordered">
            <thead>
              <tr>
                <th style="width:32px;">S.N</th>
                <th>Date</th>
                <th>Amount(RS)</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody id="advTableBody"></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Search & Clear actions - dummy implementations
    function searchSalary() {
      alert('Search by date range is for demonstration (no dynamic filter)');
    }
    function clearSalarySearch() {
      document.getElementById('searchFromDate').value = '';
      document.getElementById('searchToDate').value = '';
    }

    // Improved Advance Payment List
    let advPayments = [
      { date: "2019-04-12", amt: 6500 },
      { date: "2019-04-18", amt: 1 }
    ];
    let editingIdx = null;

    function renderAdvTable() {
      const tbody = document.getElementById('advTableBody');
      tbody.innerHTML = '';
      advPayments.forEach((item, idx) => {
        if (editingIdx === idx) {
          tbody.innerHTML += `
            <tr>
              <td>${idx + 1}</td>
              <td><input type="date" class="form-control form-control-sm" value="${item.date}" id="editDate${idx}"></td>
              <td><input type="number" class="form-control form-control-sm" min="1" value="${item.amt}" id="editAmt${idx}"></td>
              <td>
                <button class="btn btn-success btn-sm" onclick="saveEditAdvance(${idx})">Save</button>
                <button class="btn btn-secondary btn-sm" onclick="cancelEditAdvance()">Cancel</button>
              </td>
            </tr>
          `;
        } else {
          tbody.innerHTML += `
            <tr>
              <td>${idx + 1}</td>
              <td>${item.date}</td>
              <td>${item.amt}</td>
              <td>
                <button class="btn btn-warning btn-sm" onclick="editAdvance(${idx})">Edit</button>
                <button class="btn btn-danger btn-sm" onclick="deleteAdvance(${idx})">Delete</button>
              </td>
            </tr>
          `;
        }
      });
    }

    document.getElementById('advanceForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const date = document.getElementById('advDate').value;
      const amt = parseInt(document.getElementById('advAmount').value, 10);
      const errorSpan = document.getElementById('advError');
      errorSpan.textContent = '';

      if (!date || !amt || amt < 1) {
        errorSpan.textContent = "Please enter a valid date and amount.";
        return;
      }

      advPayments.push({ date, amt });
      renderAdvTable();
      document.getElementById('advDate').value = '';
      document.getElementById('advAmount').value = '';
    });

    function editAdvance(idx) { editingIdx = idx; renderAdvTable(); }
    function cancelEditAdvance() { editingIdx = null; renderAdvTable(); }
    function saveEditAdvance(idx) {
      const newDate = document.getElementById('editDate'+idx).value;
      const newAmt = parseInt(document.getElementById('editAmt'+idx).value, 10);
      if (!newDate || newAmt < 1) return;
      advPayments[idx] = { date: newDate, amt: newAmt };
      editingIdx = null;
      renderAdvTable();
    }
    function deleteAdvance(idx) {
      advPayments.splice(idx, 1);
      editingIdx = null;
      renderAdvTable();
    }

    renderAdvTable();
  </script>
</body>
</html>
